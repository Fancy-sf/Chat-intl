Instant Messaging(IM)은 동시성이 높은 시나리오에 대한 신뢰성 높은 풍부한 운영 노하우를 갖고 있습니다. 현재 자체 개발 또는 서드 파티에서 제공하는 인스턴트 메시징 서비스를 사용 중인 App 개발자의 경우, IM 통합 시 마이그레이션 문제를 먼저 고려해야 합니다. IM은 다양한 시나리오에 대한 맞춤형 마이그레이션 솔루션을 제공합니다.

## 용어 정의

본 문서 중의 용어는 다음과 같이 정의됩니다.

-  **기존 시스템:**App에서 기존 사용 중인 인스턴트 메시징 서비스.
-  **신규 시스템:**Tencent Cloud IM 서비스.
-  **App 1.0:**기존 시스템 기반으로 인스턴트 메시징 기능을 구현하는 App.
-  **App 2.0:**신규 시스템 기반으로 인스턴트 메시징 기능을 구현하는 App.
-  **메시지 라우팅(메시지 콜백)서비스:**서드 파티 통신 서비스 제공 업체에서 메시지를 받은 후, App 백엔드에 메시지를 전달하는 것으로 IM의 [1:1 채팅 메시지 발송 후 콜백](https://intl.cloud.tencent.com/document/product/1047/34365)과 유사합니다.

인스턴트 메시징 서비스 백엔드를 기존 시스템에서 신규 시스템으로 전환하고 App 1.0을 App 2.0으로 업그레이드하려면 마이그레이션 프로세스가 필수적입니다.

## 마이그레이션 솔루션

IM은 선택할 수 있는 다음 두 가지 마이그레이션 솔루션을 제공합니다. 솔루션별로 마이그레이션 효과 및 실행 난이도가 크게 다릅니다. App의 현재 인스턴트 메시징 시나리오를 종합적으로 고려하여 마이그레이션 솔루션을 적절히 선택해야 합니다.

### 필수 업그레이드 솔루션

필수 업그레이드 정책은 IM 데이터 동기화 완료 후, 강제로 App을 1.0에서 2.0으로 업그레이드하는 것입니다. 해당 솔루션은 간단히 실행할 수 있고, 업그레이드 후, 신규 App과 기존 App 사이의 호환성 문제도 발생하지 않습니다. 구체적인 솔루션은 다음 이미지와 같습니다.

![](https://main.qcloudimg.com/raw/e37a5686c81c73827c20312169c3ecc0.png)

주요 프로세스는 다음과 같습니다. 

1. 다음 항목을 포함한 이전 데이터 IM으로 가져오기.
   - 계정 가져오기
   - 사용자 프로필 정보 가져오기 
   - 사용자 관계망 가져오기
   - 1:1 채팅 메시지 기록 가져오기
   - 그룹 데이터 가져오기
   - 그룹 채팅 메시지 기록 가져오기
2. App 1.0에서 App 2.0으로 강제 업그레이드.
3. 기존 시스템은 비활성화되고, 사용자 커뮤니케이션 활동은 모두 신규 시스템에서 처리.

### 신규 App과 기존 App 호환 솔루션

신규 App과 기존 App은 공존할 수 있으며, 메시기가 상호 동기화됩니다. App 1.0이 비활성화되기 전까지, App 백엔드는 신규/기존 시스템 간에 실시간 양방향 동기화를 유지해야 합니다. 이 솔루션은 상대적으로 복잡하지만, 더 좋은 사용자 경험을 선사합니다. 구체적인 솔루션은 다음 이미지와 같습니다. 

![](https://main.qcloudimg.com/raw/3b19fed85458fa96ae7110fea8cb8e41.png)

주요 프로세스는 다음과 같습니다.

1. 다음 항목을 포함한 이전 데이터 IM으로 가져오기.
   - 계정 가져오기
   - 사용자 프로필 정보 가져오기
   - 사용자 관계망 가져오기
   - 1:1 채팅 메시지 기록 가져오기
   - 그룹 데이터 가져오기
   - 그룹 채팅 메시지 기록 가져오기
2. App 신규/기존 시스템의 다음 항목을 포함한 데이터 상호 동기화.
   - 1:1 채팅 메시지 실시간 동기화
   - 그룹 데이터 및 그룹 채팅 메시지 실시간 동기화
3. 신규/기존 시스템 공존 및 메시지 동기화, 기존 App은 단계적으로 자연스럽게 제거됨. 

## 마이그레이션 작업 상세

### 계정 가져오기

각종 데이터를 가져오려면 먼저 계정 가져오기를 해야 합니다.
App 백엔드는 [계정 일괄 가져오기 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/34954)를 호출하여 기존 계정을 전부 IM로 가져오기 합니다. 계정 가져오기와 동시에 사용자 닉네임과 프로필 사진도 가져오려면, [단일 계정 가져오기 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/34953)를 호출해야 합니다.

### 사용자 프로필 정보 가져오기

[프로필 정보 설정 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/34916)를 호출하여 기존 사용자 프로필 정보를 IM으로 가져옵니다.

### 사용자 관계망 가져오기

[친구 가져오기 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/34903)를 호출하여 기존 관계망을 IM으로 가져옵니다.

### 1:1 채팅 메시지 기록 가져오기

[1:1 채팅 메시지 가져오기 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/35014)를 호출하여 기존 1:1 채팅 메시지를 IM으로 가져옵니다.

### 1:1 채팅 메시지 읽음 설정

[1:1 채팅 메시지 읽음 표시 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/38996)를 호출하여 1:1 채팅 메시지를 읽음 상태로 설정합니다.

### 그룹 데이터 및 그룹 채팅 메시지 기록 가져오기

그룹 데이터, 그룹 채팅 메시지 기록 가져오기 프로세스는 다음과 같습니다.

1. [그룹 프로필 정보 가져오기 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/34967)를 호출하여 그룹을 생성합니다. 해당 인터페이스 호출 시, 초기 그룹 구성원을 지정할 수 있습니다.
2. 그룹 가져오기 할 때 그룹 구성원을 가져오지 않는다면 [그룹 구성원 가져오기 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/34969)를 호출하여 그룹 구성원을 가져올 수 있습니다.
3. [그룹 메시지 가져오기 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/34968)를 호출하여 그룹 채팅 메시지 기록을 가져올 수 있습니다. 
4. 그룹 구성원 읽지 않은 메시지 수 수정은 [구성원 읽지 않은 메시지 수 설정 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/34909)를 호출하여 진행할 수 있습니다.

1:1 채팅 메시지, 그룹 데이터 및 그룹 메시지는 모두 신규 시스템에 호스팅되어야 합니다. 이러한 유형의 새 데이터가 신규 시스템에서 생성되면, IM에서 제공하는 콜백을 통해 기존 시스템과 동기화합니다. 또한, 기존 시스템에서 생성된 새 데이터 역시 신규 시스템과 동기화되어야 합니다.

### 1:1 채팅 메시지 동기화

기존 시스템에 새 메시지가 생성되면 [단일 1:1 채팅 메시지 발송 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/34919)를 호출하여 IM으로 동기화하고, IM에 새 메시지가 생성되면 [1:1 채팅 메시지 발송 후 콜백](https://intl.cloud.tencent.com/document/product/1047/34365)을 호출하여 기존 시스템에 동기화합니다.

### 그룹 데이터 및 그룹 채팅 메시지 동기화

**그룹 프로필 정보 동기화**

1. 기존 시스템의 그룹 프로필 정보가 변경되면, [그룹 프로필 정보 수정 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/34962)를 호출하여 실시간으로 동기화해야 합니다.
2. IM의 그룹 프로필 정보가 변경되면, [그룹 생성 후 콜백](https://intl.cloud.tencent.com/document/product/1047/34369), [그룹 해산 후 콜백](https://intl.cloud.tencent.com/document/product/1047/34377) 및 [그룹 프로필 정보 수정 후 콜백](https://intl.cloud.tencent.com/document/product/1047/34378)을 호출하여 기존 시스템에 동기화해야 합니다.

**그룹 구성원 정보 동기화**

1. 기존 시스템에서 구성원이 추가/삭제되면, [그룹 구성원 추가 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/34962) 및 [그룹 구성원 삭제 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/34949)를 호출하여 IM에 동기화해야 합니다.
2. IM에서 구성원이 그룹에 참여/퇴장하면, [신규 구성원 그룹 참여 후 콜백](https://intl.cloud.tencent.com/document/product/1047/34372) 및 [그룹 구성원 퇴장 후 콜백](https://intl.cloud.tencent.com/document/product/1047/34373)을 호출하여 기존 시스템에 동기화해야 합니다.

**그룹 메시지 동기화**

1. 기존 시스템의 새 그룹 채팅 메시지는 그룹의 [그룹 내 일반 메시지 발송 REST 인터페이스](https://intl.cloud.tencent.com/document/product/1047/34959)를 호출하여 IM에 동기화해야 합니다.
2. IM의 새 그룹 채팅 메시지는 [그룹 내 발언 후 콜백](https://intl.cloud.tencent.com/document/product/1047/34375)을 호출하여 기존 시스템에 동기화해야 합니다.

>!상기 솔루션이 App의 기존 인스턴트 메시징 서비스에 적용되지 않는 경우, 고객 서비스 또는 비즈니스 매니저에게 적절한 마이그레이션 솔루션을 문의할 수 있습니다.
